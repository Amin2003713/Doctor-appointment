@page "/calendar"

@using App.Applications.Appointments
@using App.Applications.Schedules.Requests.GetSlots
@using Heron.MudCalendar
@using UI.Components.Common.BaseComponents

<PersianClinicCalendar
    Appointments="@_appointments"
    ShowToolbar="@ShowToolbar"
    ShowMonth="true"
    ShowWeek="true"
    ShowDay="true"
    ShowCurrentTime="true"
    WorkDayStartHour="9"
    WorkDayEndHour="18"
    View="CalendarView.Month"
/>

@code {
    [Parameter] public bool ShowToolbar { get; set; }

    private List<AppointmentResponse> _appointments = [];
    [SupplyParameterFromQuery] public Guid? ServiceId { get; set; } = null!;
    [SupplyParameterFromQuery] public DateOnly? Date { get; set; } = null!;


    protected override async Task OnInitializedAsync()
    {
        if (ServiceId.HasValue && Date.HasValue)
        {
            var slots = await Mediator.Send(new GetAvailableSlotsRequest(Date.Value, ServiceId.Value));
            Console.WriteLine(slots.Any());
            var emptySpot = slots.Select(a => new AppointmentResponse()
            {
                PatientFullName = "نوبت خالی",
                Status          = AppointmentStatus.EmptySlot
            });

            _appointments.AddRange(emptySpot);
        }

    }

}
